<%- include("headr.ejs"); %>



<style>
.clickColor{background-color: black;}

.hit{background-color: red}
.miss{background-color: cadetblue;}
.wh{background-color: white;}
/* button style */
/* button style Rotate */
#rotateShipBut {
  border-radius: 4px;
  background-color: #f4511e;
  border: none;
  color: #FFFFFF;
  text-align: center;
  font-size: 28px;
  padding: 20px;
  width: 200px;
  transition: all 0.5s;
  cursor: pointer;
  margin: 20px;
  
}
/* \25B6 */

#rotateShipBut span {
  cursor: pointer;
  display: inline-block;
  position: relative;
  transition: 0.5s;
}
/*Rotate ship*/
#rotateShipBut span::after {
  content: ' \21BB';
  position: absolute;
  opacity: 0;
  top: 0;
  right: -20px;
  transition: 0.5s;
}
/*start game*/

#rotateShipBut:hover span {
  padding-right: 25px;
}

#rotateShipBut:hover span:after {
  opacity: 1;
  right: 0;
}





/* button style start game */
#startGame {
  border-radius: 4px;
  background-color: #f4511e;
  border: none;
  color: #FFFFFF;
  text-align: center;
  font-size: 28px;
  padding: 20px;
  width: 200px;
  transition: all 0.5s;
  cursor: pointer;
  margin: 20px;
  
}
/* \25B6 */

#startGame span {
  cursor: pointer;
  display: inline-block;
  position: relative;
  transition: 0.5s;
}
/*Rotate ship*/
#startGame span::after {
  content: ' \25B6';
  position: absolute;
  opacity: 0;
  top: 0;
  right: -20px;
  transition: 0.5s;
}
/*start game*/

#startGame:hover span {
  padding-right: 25px;
}

#startGame:hover span:after {
  opacity: 1;
  right: 0;
}


/* modal */
/* modal */
/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

</style>

<div>
    <div></div>
    <div></div>
    <div></div>
</div>

<div id="wrapper">

<div id="left">
    <h1 style="text-align: center;">player #2</h1>
    <h1 id="plTurn"></h1>
</div>
    
<div id="playerBoard">
    <br>
    <br>
<table>
    <tr>
        <td>#</td>
        <td>A</td>
        <td>B</td>
        <td>C</td>
        <td>D</td>
        <td>E</td>
        <td>F</td>
        <td>G</td>
        <td>H</td>
        <td>I</td>
        <td>G</td>
    </tr>
    <tr>
        <td>1</td>
        <td onclick="change(0)" id="0"></td>
        <td onclick="change(1)" id="1"></td>
        <td onclick="change(2)" id="2"></td>
        <td onclick="change(3)" id="3"></td>
        <td onclick="change(4)" id="4"></td>
        <td onclick="change(5)" id="5"></td>
        <td onclick="change(6)" id="6"></td>
        <td onclick="change(7)" id="7"></td>
        <td onclick="change(8)" id="8"></td>
        <td onclick="change(9)" id="9"></td>
    </tr>
    <tr>
        <td>2</td>
        <td onclick="change(10)" id="10"></td>
        <td onclick="change(11)" id="11"></td>
        <td onclick="change(12)" id="12"></td>
        <td onclick="change(13)" id="13"></td>
        <td onclick="change(14)" id="14"></td>
        <td onclick="change(15)" id="15"></td>
        <td onclick="change(16)" id="16"></td>
        <td onclick="change(17)" id="17"></td>
        <td onclick="change(18)" id="18"></td>
        <td onclick="change(19)" id="19"></td>
    </tr>
    <tr>
        <td>3</td>
        <td onclick="change(20)" id="20"></td>
        <td onclick="change(21)" id="21"></td>
        <td onclick="change(22)" id="22"></td>
        <td onclick="change(23)" id="23"></td>
        <td onclick="change(24)" id="24"></td>
        <td onclick="change(25)" id="25"></td>
        <td onclick="change(26)" id="26"></td>
        <td onclick="change(27)" id="27"></td>
        <td onclick="change(28)" id="28"></td>
        <td onclick="change(29)" id="29"></td>
    </tr>
    <tr>
        <td>4</td>
        <td onclick="change(30)" id="30"></td>
        <td onclick="change(31)" id="31"></td>
        <td onclick="change(32)" id="32"></td>
        <td onclick="change(33)" id="33"></td>
        <td onclick="change(34)" id="34"></td>
        <td onclick="change(35)" id="35"></td>
        <td onclick="change(36)" id="36"></td>
        <td onclick="change(37)" id="37"></td>
        <td onclick="change(38)" id="38"></td>
        <td onclick="change(39)" id="39"></td>
    </tr>
    <tr>
        <td>5</td>
        <td onclick="change(40)" id="40"></td>
        <td onclick="change(41)" id="41"></td>
        <td onclick="change(42)" id="42"></td>
        <td onclick="change(43)" id="43"></td>
        <td onclick="change(44)" id="44"></td>
        <td onclick="change(45)" id="45"></td>
        <td onclick="change(46)" id="46"></td>
        <td onclick="change(47)" id="47"></td>
        <td onclick="change(48)" id="48"></td>
        <td onclick="change(49)" id="49"></td>
    </tr>
    <tr>
        <td>6</td>
        <td onclick="change(50)" id="50"></td>
        <td onclick="change(51)" id="51"></td>
        <td onclick="change(52)" id="52"></td>
        <td onclick="change(53)" id="53"></td>
        <td onclick="change(54)" id="54"></td>
        <td onclick="change(55)" id="55"></td>
        <td onclick="change(56)" id="56"></td>
        <td onclick="change(57)" id="57"></td>
        <td onclick="change(58)" id="58"></td>
        <td onclick="change(59)" id="59"></td>
    </tr>
    <tr>
        <td>7</td>
        <td onclick="change(60)" id="60"></td>
        <td onclick="change(61)" id="61"></td>
        <td onclick="change(62)" id="62"></td>
        <td onclick="change(63)" id="63"></td>
        <td onclick="change(64)" id="64"></td>
        <td onclick="change(65)" id="65"></td>
        <td onclick="change(66)" id="66"></td>
        <td onclick="change(67)" id="67"></td>
        <td onclick="change(68)" id="68"></td>
        <td onclick="change(69)" id="69"></td>
    </tr>
    <tr>
        <td>8</td>
        <td onclick="change(70)" id="70"></td>
        <td onclick="change(71)" id="71"></td>
        <td onclick="change(72)" id="72"></td>
        <td onclick="change(73)" id="73"></td>
        <td onclick="change(74)" id="74"></td>
        <td onclick="change(75)" id="75"></td>
        <td onclick="change(76)" id="76"></td>
        <td onclick="change(77)" id="77"></td>
        <td onclick="change(78)" id="78"></td>
        <td onclick="change(79)" id="79"></td>
    </tr>
    <tr>
        <td>9</td>
        <td onclick="change(80)" id="80"></td>
        <td onclick="change(81)" id="81"></td>
        <td onclick="change(82)" id="82"></td>
        <td onclick="change(83)" id="83"></td>
        <td onclick="change(84)" id="84"></td>
        <td onclick="change(85)" id="85"></td>
        <td onclick="change(86)" id="86"></td>
        <td onclick="change(87)" id="87"></td>
        <td onclick="change(88)" id="88"></td>
        <td onclick="change(89)" id="89"></td>
    </tr>
    <tr>
        <td>10</td>
        <td onclick="change(90)" id="90"></td>
        <td onclick="change(91)" id="91"></td>
        <td onclick="change(92)" id="92"></td>
        <td onclick="change(93)" id="93"></td>
        <td onclick="change(94)" id="94"></td>
        <td onclick="change(95)" id="95"></td>
        <td onclick="change(96)" id="96"></td>
        <td onclick="change(97)" id="97"></td>
        <td onclick="change(98)" id="98"></td>
        <td onclick="change(99)" id="99"></td>
    </tr>
</table>

</div>

<div id="right">
   <br>
   <br>
    <button class="button" id="rotateShipBut" onclick="rotate()"><span> Rotate </span></button>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <button class="button" id="startGame" onclick="start()" ><span> Ready </span></button>
</div>


<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <p id="winTxt"></p>

    </div>
  
  </div>
</div>
</body>
<script>

// function changeColor(cell)
// {
//     document.getElementById(cell).classList.add("clickColor");
// }



    


    isStart = 0;

    function start()
    {
        if(ships == 5 )
        {
            for(cell = 0; cell < 100; cell++)
            {
                document.getElementById(cell).style.backgroundColor = "white";
            }
            isStart = 1;
            let response = fetch(`/p2Ready`)
        }
        else
        {
            document.getElementById("winTxt").innerText = `place 5 ships`;
            Win();
        }

    }




    var position = 0;// 0 = vertiacal, 1 = diagonal
    function rotate()
    {
        console.log(position);
        if(position == 0)
        {
             position = 1;
        }
        else
        {
            position = 0;
        }
        console.log(position);
    }
    function hit(c){

         document.getElementById(c).style.backgroundColor = "red";
        console.log("hit")
        
    }
    function miss(c)
    {
        console.log("miss")
        document.getElementById(c).style.backgroundColor = "cadetblue";
    }


    var ships = 0
    async function change(cell)
    {  
        size = 3;
        console.log("is start = "+ isStart)
        if(isStart == 0 && ships <= 4){
            let response = await fetch(`/GetMove2/${cell}/${size}/${position}`)
            let data = await response.json();
            //console.log(data);
            if(data.cell != -1)
            {
                ships++;
                if(position == 0)
                {
                        for(var a = cell; a <= cell+2; a++ )
                    {
                        document.getElementById(a).classList.add("clickColor");
                    }
                }
                else
                {
                    for(var b = cell; b <= cell+20; b= b+10 )
                    {
                        document.getElementById(b).classList.add("clickColor");
                    }
                }
            }
        }
        else if(turn == 2 && isStart == 1){

            let response = await fetch(`/sendMove2/${cell}`)
            let data = await response.json();
            console.log(data);
            console.log("cell = " + cell)
            if(data.cell == 1)
            {
                hit(cell)
            }
            else{
                miss(cell)
            }
        }

    }

    async function getTurn()
    {
        let response = await fetch('/whoTurn');
            let data = await response.json();
            console.log("p1 =  "+ data.p1);
            console.log("p2 =  "+ data.p2);
            turn = data.last;
            if(data.p1 != 1 && isStart == 1)
            {
                document.getElementById("winTxt").innerText = `waiting for player 1`;
                Win();
            }
            else if(data.p1 == 1 && isStart == 1)
            {
                modal.style.display = "none";
                document.getElementById("plTurn").innerText = `it's player ${turn} turn`

            }
            if(data.isGameOn == 0 && isStart == 1)
            {
                document.getElementById("winTxt").innerText = `player ${turn} won the game`;
                Win();
            }
    }

    setInterval(getTurn,500);


    //modal
    // Get the modal
    var modal = document.getElementById("myModal");

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal 
    function Win() {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    function win() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
</html>